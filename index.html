<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"
  />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Audiowide&family=Orbitron:wght@500;700&display=swap" rel="stylesheet" />
  <title>Void Skies v1.1.2 ‚Ä¢ 1P (Auto-fire)</title>
  <style>
    :root {
      --bg:#05070b; --fg:#e6f0ff;
      --accent:#5eead4; --p1:#5eead4; --p2:#f472b6; --danger:#f87171;
      --panel:#0f1524; --edge:rgba(255,255,255,.12);
      --hud-text: clamp(10px, 1.2vw, 14px);
      --btn-text: clamp(12px, 1.3vw, 16px);
      --btn-pad-y: clamp(6px, 0.8vw, 10px);
      --btn-pad-x: clamp(10px, 1.5vw, 14px);
      --maxw: 95vw;
    }
    html,body{
      height:100%;margin:0;
      background:radial-gradient(1200px 800px at 50% 40%, #0d1220, var(--bg));
      color:var(--fg);
      font-family:'Audiowide', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
    }
    #wrap{position:fixed;inset:0;display:grid;place-items:center;min-height:100svh;padding:
      calc(8px + env(safe-area-inset-top))
      calc(8px + env(safe-area-inset-right))
      calc(8px + env(safe-area-inset-bottom))
      calc(8px + env(safe-area-inset-left));}
    .stage{
      width:min(95vw, var(--maxw)); aspect-ratio:16/9; position:relative; display:grid; place-items:center;
      background:#000; border-radius:12px; overflow:hidden; box-shadow:0 10px 40px rgba(0,0,0,.5);
      container-type:inline-size;
    }
    canvas{background:transparent; border-radius:16px; touch-action:none; cursor:none;}

    /* Top overlay inside the game frame */
    #topBar{position:absolute; left:0; right:0; top:0; display:grid; place-items:center; padding:6px; pointer-events:none;}
    /* STACKED + CENTERED HUD */
    #hud{display:grid; gap:4px; pointer-events:none; font-size:var(--hud-text); justify-items:center; align-items:center; width:100%; max-width:500px;}
    .hud-card{pointer-events:none; border:1px solid var(--edge); background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); backdrop-filter:blur(8px); padding:4px 8px; border-radius:8px; width:100%;}
    .hud-title{opacity:.85; font-weight:600; margin-bottom:2px; font-family:'Orbitron','Audiowide',ui-sans-serif; text-align:center; font-size:10px;}
    .bar{height:6px;width:100%;background:rgba(255,255,255,.08);border-radius:999px;overflow:hidden;border:1px solid var(--edge);margin-top:2px}
    .bar>span{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#38bdf8)}

    /* announce banner */
    #announce{position:absolute; left:50%; transform:translateX(-50%); top:40px; background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.04)); border:1px solid var(--edge); padding:6px 10px; border-radius:10px; font-weight:600; text-shadow:0 1px 0 rgba(0,0,0,.3); font-family:'Orbitron','Audiowide',ui-sans-serif; font-size:12px;}

    /* bottom-right diagnostics */
    #diagBox{position:absolute; right:8px; bottom:8px; display:grid; gap:4px; pointer-events:none;}
    .chip{pointer-events:none; background:rgba(0,0,0,.45); border:1px solid var(--edge); padding:4px 8px; border-radius:8px; font-size:10px; letter-spacing:.3px; font-family:'Orbitron','Audiowide',ui-sans-serif; text-align:right}

    .btn{background:#0b1220;color:var(--fg);border:1px solid var(--edge);border-radius:12px;padding:var(--btn-pad-y) var(--btn-pad-x);font-size:var(--btn-text);cursor:pointer;touch-action:manipulation;-webkit-user-select:none;user-select:none}
    .panel{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);background:rgba(5,7,11,.9);border:1px solid var(--edge);border-radius:16px;padding:20px;width:min(900px,92vw);pointer-events:auto;backdrop-filter:blur(12px);color:var(--fg)}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
    .hide{display:none!important}

    /* Below-canvas high-scores board */
    #belowBoard{width:min(95vw, var(--maxw)); margin:8px auto 0; padding:8px; display:grid; gap:8px;}
    #hsCard{border:1px solid var(--edge); background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); backdrop-filter:blur(8px); padding:8px; border-radius:8px;}
    #hsCard h3{margin:0 0 6px 0; font-family:'Orbitron','Audiowide',ui-sans-serif; text-align:center; font-size:14px;}
    #hsList{list-style:decimal; margin:0; padding:0 0 0 1rem; line-height:1.4; font-size:12px;}

    @media (max-width: 820px){
      canvas{width:100vw;height:auto;max-height:75vh;border-radius:8px}
      .panel{width:min(700px,94vw)}
      .stage{width:98vw;}
      #belowBoard{width:98vw;}
    }
  </style>
</head>
<body>
  <div id="wrap">
    <div>
      <div class="stage" id="stage">
        <!-- TOP overlay -->
        <div id="topBar">
          <div id="hud">
            <div id="hudWaveContent" class="hud-card"></div>
            <div id="hudPilotContent" class="hud-card"></div>
          </div>
          <div id="announce" class="hide" aria-live="polite"></div>
        </div>

        <!-- CANVAS -->
        <canvas id="game" width="960" height="540"></canvas>

        <!-- BOTTOM-RIGHT DIAGNOSTICS -->
        <div id="diagBox">
          <div id="versionBadge" class="chip">Void Skies v1.1.2 ‚Ä¢ 1P</div>
          <div class="chip">FPS <span id="fps">‚Äî</span></div>
          <a class="chip" href="https://github.com/kuhn8tor/VoidBox" target="_blank" rel="noopener">About / GitHub</a>
        </div>
      </div>

      <!-- BELOW-CANVAS HIGH SCORES -->
      <div id="belowBoard">
        <div id="hsCard">
          <h3>üèÜ High Scores</h3>
          <ol id="hsList"></ol>
        </div>
      </div>
    </div>
  </div>

  <!-- Panels -->
  <div id="ui">
    <div id="highScorePanel" class="panel hide">
      <h2 style="font-family:'Orbitron'">üèÜ New High Score!</h2>
      <p>Enter your callsign:</p>
      <input id="playerNameInput" maxlength="16" autocapitalize="characters" autocomplete="off"
             style="width:100%;padding:10px 12px;font-size:16px;margin-bottom:10px;border-radius:10px;border:1px solid var(--edge);background:#0b1220;color:var(--fg)" />
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button id="saveScoreBtn" class="btn" type="button">Save</button>
        <button id="cancelName" class="btn" type="button">Cancel</button>
      </div>
    </div>

    <div id="scoreboardPanel" class="panel hide">
      <h2 style="font-family:'Orbitron'">üìú High Scores</h2>
      <ul id="scoreList" style="line-height:1.6"></ul>
      <div style="display:flex;justify-content:flex-end"><button id="closeScoresBtn" class="btn" type="button">Close</button></div>
    </div>

    <div id="settingsPanel" class="panel hide">
      <h2 style="font-family:'Orbitron','Audiowide'">Settings</h2>
      <div class="row" style="margin-top:8px">
        <button id="resetProgress" class="btn" type="button">Reset Progress</button>
        <button id="closeSettings" class="btn" type="button" style="margin-left:auto">Close</button>
      </div>
    </div>
    <div id="levelPanel" class="panel hide">
      <h2 style="font-family:'Orbitron','Audiowide'">Level Up</h2>
      <p id="levelWho">Player leveled up! Choose a skill.</p>
      <div id="skillsGrid" class="grid"></div>
      <div class="row" style="justify-content:flex-end"><button id="closeLevel" class="btn" type="button">Continue</button></div>
    </div>
    <div id="pausePanel" class="panel hide"><h2 style="font-family:'Orbitron','Audiowave'">‚è∏Ô∏è Paused</h2><p>Press <b>P</b> to resume.</p></div>
    <div id="gameOverPanel" class="panel hide">
      <h2 style="font-family:'Orbitron','Audiowide'">üí• Game Over</h2>
      <p>Your ship was destroyed. Tap <b>Restart</b> to play again.</p>
      <div class="row" style="justify-content:flex-end"><button id="restartBtn" class="btn" type="button">Restart</button></div>
    </div>
    <div id="shopPanel" class="panel hide">
      <h2 style="font-family:'Orbitron','Audiowide'">üõ†Ô∏è Hangar Shop</h2>
      <p id="shopInfo">Spend Parts to upgrade between waves.</p>
      <div id="shopGrid" class="grid"></div>
      <div class="row" style="justify-content:flex-end"><button id="closeShop" class="btn" type="button">Launch</button></div>
    </div>
  </div>

  <button id="menuBtn" type="button" style="position:fixed;top:8px;right:8px;z-index:5;border-radius:8px;padding:6px 8px;background:rgba(255,255,255,.08);border:1px solid var(--edge);backdrop-filter:blur(8px);cursor:pointer;font-size:12px;">‚öôÔ∏è</button>

  <script>
    // Standalone main.js (no imports needed) - using in-memory storage instead of localStorage
    (() => {
      // ---------- Constants / tiny helpers ----------
      const W = 960, H = 540;
      const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
      const collide = (a, b) => {
        const dx = a.x - b.x, dy = a.y - b.y;
        const rr = (a.r || 0) + (b.r || 0);
        return dx*dx + dy*dy < rr*rr;
      };
      
      // Using in-memory storage instead of localStorage
      const memoryStore = {
        scores: [],
        playerName: ''
      };
      
      const LS = {
        load: (k, fallback) => memoryStore[k] !== undefined ? memoryStore[k] : fallback,
        save: (k, v) => memoryStore[k] = v
      };
      
      const q = (id) => document.getElementById(id);

      // ---------- Canvas attach + DPR-correct transform ----------
      const cvs = q('game');
      const ctx = cvs.getContext('2d');
      const stage = q('stage');

      function resize() {
        const rect = stage.getBoundingClientRect();
        const cssW = Math.floor(rect.width);
        const cssH = Math.floor(rect.height);
        const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
        cvs.style.width = cssW + 'px';
        cvs.style.height = cssH + 'px';
        cvs.width = Math.floor(cssW * dpr);
        cvs.height = Math.floor(cssH * dpr);
        // draw in logical game coords regardless of CSS/DPR
        ctx.setTransform(cvs.width / W, 0, 0, cvs.height / H, 0, 0);
      }
      new ResizeObserver(resize).observe(stage); resize();

      // ---------- Pointer ‚Üí game coords ----------
      const mouse = { x: W / 2, y: H * 0.8 };
      function pointFromEvent(e) {
        const r = cvs.getBoundingClientRect();
        const cx = 'clientX' in e ? e.clientX : e.touches[0].clientX;
        const cy = 'clientY' in e ? e.clientY : e.touches[0].clientY;
        const scaleX = W / r.width, scaleY = H / r.height;
        return { x: (cx - r.left) * scaleX, y: (cy - r.top) * scaleY };
      }
      cvs.addEventListener('mousemove', (e) => { const p = pointFromEvent(e); mouse.x = p.x; mouse.y = p.y; });
      cvs.addEventListener('touchstart', (e) => { const p = pointFromEvent(e); mouse.x = p.x; mouse.y = p.y; e.preventDefault(); }, { passive:false });
      cvs.addEventListener('touchmove',  (e) => { const p = pointFromEvent(e); mouse.x = p.x; mouse.y = p.y; e.preventDefault(); }, { passive:false });

      // ---------- Minimal game state ----------
      const store = {
        frame: 0, last: performance.now(),
        world:  { wave: 1, score: 0 },
        player: { x: W*0.5, y: H-60, r: 14, hp: 180, hpMax: 180, fireT: 0, speed: 440 },
        boss:   null,
        bullets: [],
        eBullets: [],
        enemies: [],
        scores: LS.load('scores', []),
        name:   LS.load('playerName', '')
      };

      // press "N" to set pilot name
      addEventListener('keydown', (e) => {
        if (e.key.toLowerCase() === 'n') {
          const v = prompt('Enter callsign (max 16 chars)', store.name || '') || '';
          store.name = v.slice(0,16).trim();
          LS.save('playerName', store.name);
          updateHUD();
        }
      });

      // ---------- Spawner (very simple) ----------
      let spawnLeft = 8, spawnTimer = 0, spawnInterval = 0.8;
      function initWave() {
        spawnLeft = 6 + Math.floor(store.world.wave * 1.5);
        spawnTimer = 0;
        spawnInterval = Math.max(0.28, 0.95 - store.world.wave * 0.05);
        announce(`Wave ${store.world.wave}`);
      }

      function stepSpawner(dt) {
        spawnTimer += dt;
        if (spawnLeft > 0 && spawnTimer >= spawnInterval) {
          spawnTimer = 0; spawnLeft--;
          store.enemies.push(spawnEnemy(['grunt','grunt','bruiser','viper'][Math.floor(Math.random()*4)]));
        }
        const empty = store.enemies.length === 0 && !store.boss && spawnLeft === 0;
        if (empty) { store.world.wave++; initWave(); }
      }

      function spawnEnemy(type='grunt') {
        const r = 12, v = type==='viper' ? 120 : 70, hp = type==='bruiser'? 36 : 20;
        return { type, x: 20 + Math.random() * (W-40), y: -50 - Math.random()*150, r, v, hp };
      }

      // ---------- Player/Bullet/Enemy stepping ----------
      function stepPlayer(dt) {
        const p = store.player, t = mouse;
        const vx = t.x - p.x, vy = t.y - p.y, d = Math.hypot(vx, vy);
        if (d > 1) { p.x = clamp(p.x + (vx/d)*p.speed*dt, 20, W-20); p.y = clamp(p.y + (vy/d)*p.speed*dt, 20, H-20); }
        p.fireT -= dt;
        if (p.fireT <= 0) { firePlayer(); p.fireT = 0.18; }
      }
      function firePlayer() {
        const p = store.player, bspd = 380;
        store.bullets.push({x:p.x-6,y:p.y-12,vx:0,vy:-bspd,r:3,col:'#5eead4',dmg:20});
        store.bullets.push({x:p.x+6,y:p.y-12,vx:0,vy:-bspd,r:3,col:'#5eead4',dmg:20});
      }
      function stepEnemy(e, dt) {
        e.y += e.v * dt;
        if (e.y > H+30) e.dead = true;
        if (Math.random() < 0.004) store.eBullets.push({ x:e.x, y:e.y, vx:0, vy:150, r:3, col:'#94a3b8', dmg:10 });
      }

      function stepWorld(dt) {
        stepPlayer(dt);
        stepSpawner(dt);

        // enemy bullets
        for (const b of store.eBullets) {
          b.x += b.vx*dt; b.y += b.vy*dt;
          if (b.y > H+20) b.dead = true;
          if (collide(b, store.player)) {
            store.player.hp = Math.max(0, store.player.hp - (b.dmg||10));
            b.dead = true;
          }
        }
        // enemies
        for (const e of store.enemies) {
          stepEnemy(e, dt);
          if (collide(e, store.player)) {
            store.player.hp = Math.max(0, store.player.hp - 14);
            e.dead = true;
          }
        }
        // player bullets
        for (const b of store.bullets) {
          b.x += b.vx*dt; b.y += b.vy*dt;
          if (b.y < -20) b.dead = true;
          for (const e of store.enemies) {
            if (!e.dead && collide(b, e)) {
              e.hp -= (b.dmg||20); b.dead = true;
              if (e.hp <= 0) { e.dead = true; store.world.score += 5; }
            }
          }
        }

        // GC
        store.bullets = store.bullets.filter(b => !b.dead);
        store.eBullets = store.eBullets.filter(b => !b.dead);
        store.enemies = store.enemies.filter(e => !e.dead);

        // game over
        if (store.player.hp === 0) handleGameOver();
      }

      // ---------- High scores ----------
      function addScore(score) {
        const name = (store.name || 'PILOT').slice(0,16);
        const arr = store.scores || [];
        arr.push({ name, score, ts: Date.now() });
        arr.sort((a,b) => b.score - a.score);
        store.scores = arr.slice(0,10);
        LS.save('scores', store.scores);
        refreshScoreList();
      }
      function refreshScoreList() {
        const ol = q('hsList');
        if (!ol) return;
        ol.innerHTML = (store.scores||[]).map((s,i)=>`<li>${i+1}. ${escapeHtml(s.name)} ‚Äî ${s.score}</li>`).join('') || `<li>No scores yet. Play a round!</li>`;
      }
      function topScoreNameVal() {
        const t = store.scores?.[0];
        return t ? { name: t.name, score: t.score } : { name: '‚Äî', score: 0 };
      }

      // ---------- HUD / Announce / FPS ----------
      function escapeHtml(s){ s = String(s ?? ''); return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'","&#39;"); }
      function updateHUD() {
        const hc = q('hudWaveContent');
        const hp = q('hudPilotContent');
        const { name: topName, score: topScore } = topScoreNameVal();
        if (hc) hc.innerHTML = `<div class="hud-title">WAVE ‚Ä¢ SCORE</div><div style="text-align:center">Wave <b>${store.world.wave}</b> ‚Ä¢ Score <b>${store.world.score}</b> ‚Ä¢ Top <b>${escapeHtml(topName)}</b> ${topScore}</div>`;
        if (hp) {
          const p = store.player;
          const pct = Math.round(p.hp / p.hpMax * 100);
          hp.innerHTML = `<div class="hud-title">PILOT ${store.name ? ('‚Ä¢ ' + escapeHtml(store.name)) : ''}</div><div style="text-align:center">HP ${pct}%</div><div class="bar"><span style="width:${pct}%"></span></div>`;
        }
      }
      let fpsEMA = 60, fpsAlpha = 0.12;
      function updateFPS(dt) {
        const el = q('fps');
        if (!dt || !isFinite(dt) || dt <= 0) return;
        const fps = 1/dt;
        fpsEMA = fpsEMA*(1-fpsAlpha) + fps*fpsAlpha;
        if (el) el.textContent = String(Math.round(fpsEMA));
      }
      function announce(text) {
        const el = q('announce');
        if (!el) return;
        el.textContent = text;
        el.classList.remove('hide');
        clearTimeout(el._t);
        el._t = setTimeout(()=>el.classList.add('hide'), 2000);
      }

      // ---------- Render ----------
      const starsA = Array.from({ length: 80 }, () => ({ x: Math.random()*W, y: Math.random()*H }));
      const starsB = Array.from({ length: 60 }, () => ({ x: Math.random()*W, y: Math.random()*H }));
      function dot(x,y,r,c){ ctx.fillStyle=c; ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill(); }
      function drawShip(x,y,col='#5eead4'){
        ctx.save(); ctx.translate(x,y);
        ctx.beginPath(); ctx.moveTo(0,-16); ctx.lineTo(12,12); ctx.lineTo(-12,12); ctx.closePath();
        const g = ctx.createLinearGradient(0,-16,0,12); g.addColorStop(0,col); g.addColorStop(1,'#0ea5e9');
        ctx.fillStyle=g; ctx.fill(); ctx.shadowColor=col; ctx.shadowBlur=12; ctx.lineWidth=2; ctx.strokeStyle=col; ctx.stroke();
        ctx.shadowBlur=0; ctx.lineWidth=1; ctx.strokeStyle='rgba(255,255,255,.4)';
        ctx.beginPath(); ctx.moveTo(-12,8); ctx.lineTo(-20,4); ctx.moveTo(12,8); ctx.lineTo(20,4); ctx.stroke();
        ctx.globalAlpha=.85; ctx.fillStyle='rgba(94,234,212,.35)'; ctx.beginPath(); ctx.ellipse(0,14,6,3,0,0,Math.PI*2); ctx.fill(); ctx.restore();
      }
      function render(dt) {
        ctx.clearRect(0,0,W,H);
        // parallax bg
        ctx.globalAlpha = 0.25; for (const s of starsA){ s.y += 20*(1/60); if (s.y>H) s.y -= H; dot(s.x,s.y,1,'#5eead433'); }
        ctx.globalAlpha = 0.10; for (const s of starsB){ s.y += 50*(1/60); if (s.y>H) s.y -= H; dot(s.x,s.y,1.2,'#f472b633'); }
        ctx.globalAlpha = 1;

        // entities
        for (const e of store.enemies) dot(e.x,e.y,e.r,'#9ca3af');
        for (const b of store.eBullets) dot(b.x,b.y,b.r,b.col);
        for (const b of store.bullets) dot(b.x,b.y,b.r,b.col);
        drawShip(store.player.x, store.player.y);

        updateHUD();
        updateFPS(dt);
      }

      // ---------- Game over ----------
      let gameOverShown = false;
      function handleGameOver() {
        if (gameOverShown) return;
        gameOverShown = true;
        addScore(store.world.score);
        announce('üí• Game Over');
        setTimeout(() => {
          store.player.hp = store.player.hpMax;
          store.world.score = 0;
          store.enemies.length = 0; store.bullets.length = 0; store.eBullets.length = 0;
          store.world.wave = 1; initWave();
          gameOverShown = false;
        }, 1000);
      }

      // ---------- Loop ----------
      function step(dt) { stepWorld(dt); }
      function frame(now) {
        const dt = Math.min(0.033, (now - store.last)/1000);
        store.last = now; store.frame++;
        step(dt); render(dt);
        requestAnimationFrame(frame);
      }

      // ---------- Boot ----------
      refreshScoreList();
      initWave();
      requestAnimationFrame(frame);
    })();
  </script>
</body>
</html>
